---
title: QUIC协议与HTTP3.0
tags: TCP QUIC HTTP HTTP3.0
---



### 一、什么是QUIC协议

	QUIC（Quick UDP Internet Connections），即快速UDP网络连接，是被设计用在传输层的网络协议，最初由Google提出，目前已经被广泛应用于Google浏览器和Google服务器之间。目前Chorme、MicrosoftEdge、Firefox、Safari等主流浏览器均已经支持QUIC。QUIC增加了面向连接的TCP网络应用程序的性能，通过使用UDP在两个端点之间建立一系列多路复用（multiplexing） 的连接实现这个目的，它同时被用来代替TCP在网络层的作用。

### 二、为什么需要QUIC协议

#### 1、TCP协议概要
	传统架构上的网络应用开发，基本上都是在TCP（传输控制协议）和UDP（用户数据协议）之上二选一，这二者都基于IP协议开发，区别在于TCP提供面向字节流的可靠传输服务，而UDP则提供面向报文的尽力交付服务；二者相同之处在于都是基于IP协议实现的，在真正传输时，无论是TCP的数据块还是UDP报文都会被封装在一个IP分组的荷载中进行传输。
	<br/>
	TCP的传输需要保证数据报按顺序来接收，如果发现接收顺序错误，就需要使用自动重传请求来通知发送方重新发送数据包，同时建立连接的三次握手在复杂的网络环境和地理限制也是一个重要的考虑内容。由于TCP设计像一个"数据管道"，如果单个数据包有问题，后续的所有数据报的发送将会被阻塞。
	<br/>
	TCP 可靠传输原理：TCP通过序号、确认、重传来保证可靠传输。
	<img class="image image--xl" src="/assets/resource/docs/20190401-quic-http/20190401-quic-http-01.png"/>
	TCP端到端之间，采用缓冲区来暂存正在发送的数据，一旦数据发送出现问题（丢包导致的超时、冗余ACK等等），TCP发送端能够及时地从缓冲区中选择数据重发。
	TCP为每一个TCP报文分配一个序号 seq = a，接收方接收到序号为a的报文，就响应一个ack = a + 1的ACK响应报文来确认，如果发生了丢包导致的计时器超时、收到冗余ACK，那么会触发重传机制，重发对应的数据包。

#### 2、TCP协议存在的问题
##### 1）TCP连接耗时严重
	基于TCP的HTTP链接，需要经过三次握手，这时候消耗掉一个RTT（发送一个数据包到收到对应的ACK，所花费的时间，如下图），而HTTPS在TCP的基础上，又使用了TLS1.2进行数据加密（如下图），需要消耗2个RTT，这样一来，在建立连接时，光是TCP + TLS过程就需要消耗掉3个RTT的时间。
	<img class="image image--xl" src="/assets/resource/docs/20190401-quic-http/20190401-quic-http-02.png"/>
	这其中最大的问题就是，TCP的确认帧需要经过一个完整的RTT才可能被接收到，而TCP一个时刻发送的数据的数量会被拥塞窗口所限制，假设ssthresh设置为16，那么甚至需要5个RTT才能跑满基础的拥塞窗口，如果现实网络会在32时产生拥塞，那么根据拥塞避免算法，需要5 + 16个RTT才能最大化利用网络的带宽和吞吐量。

##### 2）TCP重传的二义性
	TCP协议采用序号来标记TCP发送的数据，当发送方发送seq = a的报文到接收端时，接收方会采用一个ack = a + 1的ACK报文来响应这个数据，当发送方接到这个ack = a + 1的应答报文时，就说明该帧被成功接收了。
	<img class="image image--xl" src="/assets/resource/docs/20190401-quic-http/20190401-quic-http-03.png"/>
	如上图所示，TCP在Initial阶段发出的帧序号为a，而经过一段时间之后，没有收到ACK，此时触发超时重传，过了一会儿收到了一个ACK帧，但是ACK帧的内容是a + 1，此时无法确认该a + 1是对initial send还是retry帧的确认（图左是对Retry的确认，图右是对Initial Retry的确认，但是到达的比较晚，已经触发了超时重传）。导致最终的超时时间计算并不准，后续超时算法的迭代时间就会产生问题，比如 触发超时重传的时间可能会不准。

##### 3）TCP队头堵塞的问题


  基于现在网络环境的应用场景对更低延迟、良好的传输性能的要求越来越高，于是提出一个新的解决方案就十分有必要。

### 三、QUIC协议介绍

#### 1、QUIC协议做了什么



#### 2、QUIC协议的特点及优势



#### 3、QUIC协议的工作原理




### 四、HTTP 1.x与HTTP 2.x






### 五、QUIC与HTTP3.0



<br/>

参考资料：

[1]. https://www.cnblogs.com/js68/p/14347830.html

[2]. https://juejin.cn/post/7085694620075556901

[3]. https://hungryturbo.com/HTTP3-explained/quic/%E5%BC%95%E8%A8%80.html 

[4]. https://www.mesalab.cn/f/article/detail?id=65
